<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Zantara - 30 Domande Business</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stats {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stat-card {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .questions-list {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .question-item {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .question-item.pending {
            border-color: #ffa726;
            background: #fff3e0;
        }

        .question-item.testing {
            border-color: #42a5f5;
            background: #e3f2fd;
            animation: pulse 2s infinite;
        }

        .question-item.success {
            border-color: #66bb6a;
            background: #e8f5e9;
        }

        .question-item.error {
            border-color: #ef5350;
            background: #ffebee;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.01); }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-id {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .question-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .status-pending { background: #ffa726; color: white; }
        .status-testing { background: #42a5f5; color: white; }
        .status-success { background: #66bb6a; color: white; }
        .status-error { background: #ef5350; color: white; }

        .question-text {
            color: #333;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .question-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .response {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.95em;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .error-msg {
            color: #ef5350;
            font-weight: bold;
        }

        .duration {
            color: #42a5f5;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Zantara - 30 Domande Business</h1>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="stat-total">30</div>
                <div class="stat-label">Totale Domande</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-success">0</div>
                <div class="stat-label">‚úÖ Successi</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-error">0</div>
                <div class="stat-label">‚ùå Errori</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-time">0s</div>
                <div class="stat-label">‚è±Ô∏è Tempo Totale</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" id="btn-start" onclick="startTest()">‚ñ∂Ô∏è Inizia Test</button>
            <button class="btn btn-secondary" id="btn-stop" onclick="stopTest()" disabled>‚èπÔ∏è Ferma</button>
            <button class="btn" onclick="exportResults()">üíæ Esporta Risultati</button>
            <label>
                <input type="checkbox" id="auto-scroll" checked> Auto-scroll
            </label>
        </div>

        <div class="questions-list" id="questions-list"></div>
    </div>

    <script>
        // 30 Domande Business
        const DOMANDE = [
            {id: 1, cat: "immigration", domanda: "Sono un imprenditore italiano con PT PMA attiva (80% foreign ownership, KBLI 62010) e 3 dipendenti indonesiani. Voglio portare mia moglie e mio figlio di 15 anni. Qual √® il percorso KITAS pi√π veloce per loro? Devo fare E31 o posso fare E23? Quali documenti servono per il figlio minorenne e quanto tempo ci vuole?"},
            {id: 2, cat: "immigration", domanda: "Ho KITAS E33G (Remote Worker) valida per 2 anni. Voglio aprire PT PMA per fare consulting. Devo cancellare E33G e rifare tutto da zero con E28A, oppure posso convertire? Se cancello E33G, perdo il visto e devo uscire dall'Indonesia? Quali sono i rischi e i tempi?"},
            {id: 3, cat: "immigration", domanda: "Mia PT PMA √® stata approvata da BKPM con capitale 10 miliardi IDR. Ho 4 azionisti stranieri (USA, Italia, Singapore, Australia) tutti al 20%. Chi di loro pu√≤ ottenere KITAS E28A Investor? Serve davvero 10 miliardi per 4 persone o bastano 2.5 miliardi? E se uno degli azionisti √® solo passive investor?"},
            {id: 4, cat: "immigration", domanda: "Ho appena fatto IMTA approval per 2 expat (Director e CTO). KITAS E23 Working sono in processing. Il mio lawyer dice che ci vogliono 45 giorni, ma ho letto che con fast track si fa in 14 giorni. Quanto costa il fast track? √à legale? Chi lo gestisce? E se qualcosa va storto con IMTA, cosa succede al KITAS?"},
            {id: 5, cat: "immigration", domanda: "Sto per sposare una ragazza indonesiana. Ho B211A visa (visit). Dopo matrimonio posso fare subito E31 Limited Stay KITAS sposato con indonesiana? Oppure devo uscire e rientrare? Quanti documenti servono? L'apostille del certificato di celibato italiano √® riconosciuto? Posso lavorare con E31 o serve aggiungere IMTA?"},
            {id: 6, cat: "immigration", domanda: "La mia PT PMA ha cambiato sede legale da Jakarta a Bali, e abbiamo fatto domicile letter update. I miei 2 expat con KITAS E23 Working devono rifare il KITAS per Bali o basta notificare immigration? C'√® un costo? E se uno di loro lavora da remoto da Bali ma il contratto dice Jakarta, √® legale?"},
            {id: 7, cat: "immigration", domanda: "Ho Golden Visa / Second Home Visa valida 10 anni (deposit 2 billion IDR). Posso aprire PT PMA e lavorare nella mia azienda? Oppure Golden Visa √® solo per investment e non posso essere Director? Se non posso lavorare, posso almeno fare shareholder meeting e firmare documenti aziendali?"},
            {id: 8, cat: "immigration", domanda: "Mio KITAS E28A Investor sta per scadere tra 30 giorni. La mia PT PMA ha avuto perdite per 2 anni consecutivi e il revenue √® sotto 500 milioni IDR. Immigration rinnover√† il KITAS oppure mi chiedono proof of investment activity? Cosa succede se rigettano il renewal? Ho diritto a exit permit?"},
            {id: 9, cat: "immigration", domanda: "Ho fatto D12 business explorer visa multiple entry per 1 anno. Ogni ingresso posso stare 60 giorni. Dopo 4 viaggi consecutivi (4x60 giorni), immigration Bali mi ha detto che devo stare fuori almeno 30 giorni. √à vero? Qual √® la legge precisa? Quante volte posso entrare in 1 anno con D12?"},
            {id: 10, cat: "immigration", domanda: "Sono cittadino USA con KITAS E33G Remote Worker. Lavoro per azienda americana (W2 employee), ma faccio anche freelance consulting per clienti indonesiani (fatturati tramite azienda USA). Immigration ha fatto controllo random e mi ha chiesto spiegazioni. Rischio cancellazione KITAS? Devo fare E23 Working invece? Quali sono le conseguenze?"},
            {id: 11, cat: "business", domanda: "Voglio aprire PT PMA per software development (KBLI 62010) con 2 soci: io italiano 70%, partner indonesiano 30%. Capitale 10 miliardi IDR. Il partner indonesiano vuole mettere asset (tanah certificato SHM Bali del valore di 8 miliardi) invece di cash. BKPM accetta asset contribution? Serve perizia indipendente? Quali tasse sulla valutazione dell'asset?"},
            {id: 12, cat: "business", domanda: "La mia PT PMA (100% foreign owned) ha fatto revenue 5 miliardi IDR nel 2024, ma net profit negativo (loss 500 milioni) a causa di marketing spend alto. Per il 2025, BKPM ha mandato warning letter dicendo che devo raggiungere minimum investment realization. Cosa significa? Rischio chiusura forzata? Come si calcola minimum investment realization?"},
            {id: 13, cat: "business", domanda: "Ho PT PMA (NIB OSS, KBLI 47911 e-commerce). Voglio aggiungere KBLI 56101 (restaurant) per aprire un ristorante fisico a Canggu. Devo fare company revision (anggaran dasar amendment) oppure posso solo aggiungere KBLI sul OSS? Il restaurant √® DNI (forbidden for foreign investment), come faccio? Serve nominee indonesiano?"},
            {id: 14, cat: "business", domanda: "Mia PT PMA ha 3 shareholders esteri (40%, 35%, 25%). Uno shareholder al 25% vuole uscire e vendere le sue shares a me. Serve notarial deed per share transfer? Qual √® la tassa? Devo fare BKPM notification? E se invece voglio diluire uno shareholder da 25% a 10% facendo capital increase, come funziona?"},
            {id: 15, cat: "business", domanda: "Ho PT PMA con sede legale a Jakarta (domicile letter di propriet√†). Voglio spostare sede operativa a Bali, ma mantenere sede legale a Jakarta. Serve fare domicile letter update a Bali? Posso avere 2 domicile letters (Jakarta legal, Bali operational)? Quali implicazioni fiscali (PPN, tax office registration)?"},
            {id: 16, cat: "business", domanda: "La mia PT PMA (62010 software) ha contratto con cliente in Singapura (payment in USD). Cliente paga su bank account Singapore mio personale perch√© la PT non ha ancora swift code. Posso fare invoice dalla PT per questo payment? Quali rischi fiscali? Devo dichiarare questo income come foreign exchange in annual tax report?"},
            {id: 17, cat: "business", domanda: "Voglio aprire PT PMA 100% foreign owned per alcohol import & distribution a Bali (KBLI 46342). Serve license SKPL (Surat Keterangan Pendaftaran Legalitas) + alcohol import permit dal Ministry of Trade. Quali sono i requisiti minimi? Quanto costa? Serve warehouse dedicato? Tempo di approval?"},
            {id: 18, cat: "business", domanda: "Mia PT PMA (consulting) ha 1 director straniero (me). Voglio aggiungere un secondo director indonesiano (local partner) per facilitare banking e government interaction. Devo fare deed of amendment? Board resolution √® sufficiente? Questo director indonesiano deve essere shareholder o pu√≤ essere solo employee con director title?"},
            {id: 19, cat: "business", domanda: "Ho PT PMA (KBLI 58130 newspaper publishing). Google Adsense ha bloccato il mio account perch√© dice che Indonesia richiede local media license. Serve surat izin usaha penerbitan pers dal Ministry of Communication? Questo √® included nel NIB OSS oppure √® separate license? Quanto tempo ci vuole?"},
            {id: 20, cat: "business", domanda: "La mia PT PMA ha chiuso operazioni e voglio fare voluntary liquidation. Ho ancora 1 expat con KITAS E23 Working legato alla PT. Devo cancellare il KITAS prima di liquidare la PT? Qual √® il processo corretto? Quanto tempo ci vuole? Posso fare liquidation mentre ho ancora employees e tax obligations pending?"},
            {id: 21, cat: "tax", domanda: "Sono tax resident in Italia, ma passo 6 mesi/anno a Bali con KITAS E28A Investor. Indonesia dice che dopo 183 giorni divento tax resident indonesiano. Italia dice che resto tax resident italiano finch√© mantengo casa e famiglia in Italia. C'√® tax treaty Italia-Indonesia? Rischio double taxation? Come dichiaro worldwide income?"},
            {id: 22, cat: "tax", domanda: "Mia PT PMA fattura 10 miliardi IDR/anno. Ho 3 expat con KITAS che guadagnano 15,000 USD/mese ciascuno (paid by PT PMA). Devo fare PPh 21 (income tax withholding) su stipendio expat? Qual √® la progressive tax rate per income sopra 500 milioni IDR/anno? Posso dedurre housing allowance e flight tickets?"},
            {id: 23, cat: "tax", domanda: "Ho PT PMA (e-commerce) che vende prodotti digitali (corsi online) a clienti indonesiani. Devo pagare PPN (VAT) 11%? Oppure prodotti digitali sono esenti? Se devo pagare PPN, serve PKP (taxable enterprise) registration dal tax office? Quali sono penalties se non sono PKP e ho venduto senza PPN per 2 anni?"},
            {id: 24, cat: "tax", domanda: "Mia PT PMA paga dividendi ai 2 shareholders stranieri (totale 500 milioni IDR). Devo fare PPh 26 (withholding tax on dividends) del 20%? Oppure con tax treaty si riduce? Se shareholders sono in Singapore (tax treaty), qual √® la rate? Devo fare tax reporting entro quando?"},
            {id: 25, cat: "tax", domanda: "Ho PT PMA che compra software licenses dalla azienda madre in USA (total 200 milioni IDR/anno). Questo √® considerato royalty payment? Devo fare PPh 26 (withholding tax) 20% su royalty? Serve tax clearance dal tax office prima del wire transfer? Come si calcola taxable base per software licensing?"},
            {id: 26, cat: "tax", domanda: "Mia PT PMA ha perso 1 miliardo IDR nel 2023 e 500 milioni nel 2024. Nel 2025 prevedo profit 2 miliardi. Posso fare loss carry-forward per offset taxes 2025? Per quanti anni si pu√≤ portare avanti le losses? Serve documentazione speciale per tax office? Quali rischi se tax office rigetta il carry-forward?"},
            {id: 27, cat: "tax", domanda: "Ho KITAS E33G Remote Worker. Lavoro per azienda USA che mi paga su bank account italiano. Non ho income indonesiano. Devo fare tax filing in Indonesia? Devo prendere NPWP? Se tax office scopre che non ho mai fatto filing, quali penalties? Posso richiedere tax residency certificate dall'Italia per evitare Indonesia tax?"},
            {id: 28, cat: "tax", domanda: "Mia PT PMA ha fatto import di equipment dal China (valore CIF 500 milioni IDR). Customs ha applicato import duty 10% + PPN 11% + PPh 22 (prepaid income tax) 2.5%. Posso deduct PPh 22 dal corporate income tax annuale? Come si fa il claim? Serve documentazione speciale? Tempo limite per claim?"},
            {id: 29, cat: "tax", domanda: "Ho PT PMA con revenue 15 miliardi IDR/anno. Tax office ha fatto audit e trovato discrepancies per 200 milioni (invoice senza PPN). Mi hanno dato assessment letter con penalty 50% + interest. Posso fare objection (keberatan)? Qual √® il processo? Devo pagare prima l'assessment e poi fare objection, oppure posso bloccare il payment durante objection?"},
            {id: 30, cat: "tax", domanda: "Sono freelance con NPWP. Lavoro da remoto per clienti internazionali (revenue 500 milioni IDR/anno). Non ho PT, lavoro come orang pribadi (individual). Devo fare PPh 25 (monthly installment) o solo annual tax filing PPh 29? Posso deduct business expenses (laptop, coworking) senza PT? Quali rischi se non ho made monthly payments?"}
        ];

        let results = [];
        let isRunning = false;
        let startTime = 0;

        // Render domande
        function renderQuestions() {
            const list = document.getElementById('questions-list');
            list.innerHTML = DOMANDE.map(q => `
                <div class="question-item pending" id="q-${q.id}">
                    <div class="question-header">
                        <span class="question-id">#${q.id}</span>
                        <span class="question-status status-pending" id="status-${q.id}">‚è≥ In attesa</span>
                    </div>
                    <div class="question-meta">
                        <span>üìÇ ${q.cat}</span>
                        <span id="duration-${q.id}"></span>
                    </div>
                    <div class="question-text">${q.domanda}</div>
                    <div class="response" id="response-${q.id}" style="display: none;"></div>
                </div>
            `).join('');
        }

        // ADATTA QUESTO A Zantara!
        async function askZantara(domanda) {
            // üî¥ MODIFICA QUESTO PER CHIAMARE LA TUA API ZANTARA
            // Se usi la webapp aperta in un altro tab, puoi usare:
            // - window.postMessage per comunicare tra tabs
            // - localStorage per passare domanda e leggere risposta
            // - oppure copia manualmente le domande nella chat!

            // Per ora simuliamo con timeout
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve({
                        success: true,
                        response: `[RISPOSTA SIMULATA] Per la domanda "${domanda.substring(0, 50)}..." - Apri Zantara in un altro tab e copia-incolla le domande manualmente. Oppure integra questo script con l'API di Zantara.`
                    });
                }, 2000);
            });
        }

        async function startTest() {
            if (isRunning) return;
            isRunning = true;
            startTime = Date.now();
            results = [];

            document.getElementById('btn-start').disabled = true;
            document.getElementById('btn-stop').disabled = false;

            for (let i = 0; i < DOMANDE.length && isRunning; i++) {
                const q = DOMANDE[i];
                await testQuestion(q, i);

                // Aggiorna stats
                updateStats();

                // Pausa tra domande
                if (i < DOMANDE.length - 1 && isRunning) {
                    await new Promise(r => setTimeout(r, 1000));
                }
            }

            document.getElementById('btn-start').disabled = false;
            document.getElementById('btn-stop').disabled = true;
            isRunning = false;
        }

        async function testQuestion(q, index) {
            const elem = document.getElementById(`q-${q.id}`);
            const statusElem = document.getElementById(`status-${q.id}`);
            const responseElem = document.getElementById(`response-${q.id}`);
            const durationElem = document.getElementById(`duration-${q.id}`);

            // Testing
            elem.className = 'question-item testing';
            statusElem.className = 'question-status status-testing';
            statusElem.textContent = 'üîÑ Testing...';

            if (document.getElementById('auto-scroll').checked) {
                elem.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            const start = Date.now();

            try {
                const result = await askZantara(q.domanda);
                const duration = Date.now() - start;

                // Success
                elem.className = 'question-item success';
                statusElem.className = 'question-status status-success';
                statusElem.textContent = '‚úÖ Completato';
                durationElem.innerHTML = `<span class="duration">${(duration/1000).toFixed(1)}s</span>`;

                responseElem.style.display = 'block';
                responseElem.textContent = result.response || 'Nessuna risposta';

                results.push({ ...q, success: true, response: result.response, duration });

            } catch (error) {
                const duration = Date.now() - start;

                // Error
                elem.className = 'question-item error';
                statusElem.className = 'question-status status-error';
                statusElem.textContent = '‚ùå Errore';
                durationElem.innerHTML = `<span class="duration">${(duration/1000).toFixed(1)}s</span>`;

                responseElem.style.display = 'block';
                responseElem.innerHTML = `<span class="error-msg">ERRORE: ${error.message}</span>`;

                results.push({ ...q, success: false, error: error.message, duration });
            }
        }

        function stopTest() {
            isRunning = false;
            document.getElementById('btn-start').disabled = false;
            document.getElementById('btn-stop').disabled = true;
        }

        function updateStats() {
            const successi = results.filter(r => r.success).length;
            const errori = results.filter(r => !r.success).length;
            const totalTime = results.reduce((sum, r) => sum + r.duration, 0);

            document.getElementById('stat-success').textContent = successi;
            document.getElementById('stat-error').textContent = errori;
            document.getElementById('stat-time').textContent = (totalTime / 1000).toFixed(1) + 's';
        }

        function exportResults() {
            const data = {
                timestamp: new Date().toISOString(),
                stats: {
                    totale: DOMANDE.length,
                    successi: results.filter(r => r.success).length,
                    errori: results.filter(r => !r.success).length,
                },
                results: results
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `zantara-test-${Date.now()}.json`;
            a.click();
        }

        // Init
        renderQuestions();
    </script>
</body>
</html>
