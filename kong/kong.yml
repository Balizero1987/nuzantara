_format_version: "3.0"

services:
  - name: backend-ts
    url: http://backend-ts:8080
    routes:
      - name: ts-routes
        paths:
          - /api/v1/ts
        strip_path: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE

  - name: backend-rag
    url: http://backend-rag:8000
    routes:
      - name: rag-routes
        paths:
          - /api/v1/rag
        strip_path: true
        methods:
          - GET
          - POST

  - name: orchestrator
    url: http://orchestrator:3000
    routes:
      - name: orchestrator-routes
        paths:
          - /api/v1/query
        strip_path: false
        methods:
          - POST

plugins:
  - name: rate-limiting
    config:
      minute: 60
      hour: 1000
      policy: local
      fault_tolerant: true

  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      headers:
        - Authorization
        - Content-Type
        - X-API-Key
      credentials: true
      max_age: 3600

  - name: prometheus
    config:
      status_code_metrics: true
      latency_metrics: true
      bandwidth_metrics: true
      upstream_health_metrics: true

  - name: request-transformer
    config:
      add:
        headers:
          - X-Service-Name:unified-gateway
          - X-Request-ID:$(uuid)
