# ============================================================================
# PYTEST CONFIGURATION
# ============================================================================

[pytest]
# Test discovery
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Python path - add backend directory for imports
pythonpath = backend

# Output options
addopts =
    # Strict mode
    --strict-markers
    --strict-config

    # Output
    --verbose
    --tb=short
    --color=yes

    # Continue on errors
    --continue-on-collection-errors

    # Warnings
    -W ignore::UserWarning
    -W ignore::DeprecationWarning

# Markers
markers =
    unit: Unit tests
    integration: Integration tests
    slow: Slow tests (deselect with '-m "not slow"')
    api: API endpoint tests
    database: Database tests
    security: Security tests

# Coverage options
[coverage:run]
source = backend
omit =
    */tests/*
    */test_*.py
    */__pycache__/*
    */.venv/*
    */migrations/*
    */venv/*
    */env/*
    */.tox/*
    setup.py
    # Exclude main entry points
    backend/app/main_cloud.py
    backend/app/main.py
    # Exclude agent runners
    backend/agents/run_*.py
    backend/agents/agents/*.py
    # Exclude scripts and utilities
    backend/scripts/*
    backend/db/migrations/*
    # Exclude routers with missing dependencies
    backend/app/routers/crm_*.py
    backend/app/routers/auth.py
    backend/app/routers/autonomous_agents.py
    backend/app/routers/conversations.py
    backend/app/routers/handlers.py
    backend/app/routers/image_generation.py
    backend/app/routers/ingest.py
    backend/app/routers/instagram.py
    backend/app/routers/intel.py
    backend/app/routers/media.py
    backend/app/routers/memory_vector.py
    backend/app/routers/notifications.py
    backend/app/routers/oracle_ingest.py
    backend/app/routers/productivity.py
    backend/app/routers/profile.py
    backend/app/routers/rag.py
    backend/app/routers/sessions.py
    backend/app/routers/settings.py
    backend/app/routers/websocket.py
    backend/app/routers/work_sessions.py
    # Exclude services without proper tests
    backend/services/gmail_service.py
    backend/services/calendar_service.py
    backend/core/embeddings_local.py

branch = True
parallel = True

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
fail_under = 70
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__:
    if TYPE_CHECKING:
    @abstractmethod
    @abc.abstractmethod
    if settings.DEBUG:

[coverage:html]
directory = htmlcov

[coverage:xml]
output = coverage.xml
