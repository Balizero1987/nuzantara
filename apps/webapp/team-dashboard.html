<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Dashboard - ZANTARA</title>
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/bali-zero-theme.css">
    <link rel="stylesheet" href="css/team-dashboard.css">
</head>

<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <h1>üìä Team Dashboard</h1>
            <div class="header-actions">
                <button id="refreshBtn" class="btn-secondary">üîÑ Refresh</button>
                <a href="chat.html" class="btn-primary">üí¨ Back to Chat</a>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Performance Trends -->
            <section class="dashboard-card">
                <div class="card-header">
                    <h2>üìà Performance Trends</h2>
                    <select id="trendsWeeks">
                        <option value="4">Last 4 weeks</option>
                        <option value="8">Last 8 weeks</option>
                        <option value="12">Last 12 weeks</option>
                    </select>
                </div>
                <div id="performanceTrends" class="card-content">
                    <div class="loading">Loading...</div>
                </div>
            </section>

            <!-- Skill Matrix -->
            <section class="dashboard-card">
                <div class="card-header">
                    <h2>üéØ Skill Matrix</h2>
                </div>
                <div id="skillMatrix" class="card-content">
                    <div class="loading">Loading...</div>
                </div>
            </section>

            <!-- Workload Distribution -->
            <section class="dashboard-card">
                <div class="card-header">
                    <h2>‚öñÔ∏è Workload Distribution</h2>
                </div>
                <div id="workloadDist" class="card-content">
                    <div class="loading">Loading...</div>
                </div>
            </section>

            <!-- Collaboration Network -->
            <section class="dashboard-card">
                <div class="card-header">
                    <h2>ü§ù Collaboration Patterns</h2>
                </div>
                <div id="collaboration" class="card-content">
                    <div class="loading">Loading...</div>
                </div>
            </section>

            <!-- Response Times -->
            <section class="dashboard-card">
                <div class="card-header">
                    <h2>‚è±Ô∏è Response Metrics</h2>
                </div>
                <div id="responseTimes" class="card-content">
                    <div class="loading">Loading...</div>
                </div>
            </section>

            <!-- Knowledge Sharing Index -->
            <section class="dashboard-card">
                <div class="card-header">
                    <h2>üí° Knowledge Sharing</h2>
                </div>
                <div id="knowledgeSharing" class="card-content">
                    <div class="loading">Loading...</div>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <!-- Authentication Guard -->
    <script src="js/auth-guard.js"></script>

    <!-- Initialize USER_CONTEXT from localStorage -->
    <script>
        // Load user context from localStorage
        const storedUser = localStorage.getItem('zantara-user');
        const storedToken = localStorage.getItem('zantara-token');

        if (storedUser && storedToken) {
            try {
                const user = JSON.parse(storedUser);
                window.UserContext = {
                    user: user,
                    token: storedToken,
                    isAuthenticated: () => !!storedToken,
                    getName: () => user.name || user.email,
                    getRole: () => user.role || 'user',
                    getEmail: () => user.email
                };
                console.log('‚úÖ UserContext initialized:', window.UserContext.getName());
            } catch (error) {
                console.error('Failed to parse user data:', error);
                window.location.href = '/login.html';
            }
        } else {
            console.warn('‚ö†Ô∏è No user data found, redirecting to login');
            window.location.href = '/login.html';
        }

        // Helper function for auth headers
        window.getAuthHeaders = function () {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${window.UserContext?.token || ''}`
            };
        };
    </script>

    <script src="js/api-config.js"></script>
    <script type="module" src="js/team-analytics-client.js"></script>
    <script src="js/team-dashboard.js"></script>
</body>

</html>