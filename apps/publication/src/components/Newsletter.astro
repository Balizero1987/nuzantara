---
// Newsletter signup component
---

<section class="container-custom breathing-room">
  <div class="bg-bz-black/30 border border-bz-gray/20 rounded-2xl p-12 md:p-16">
    <div class="max-w-2xl mx-auto text-center">
      <!-- Icon -->
      <div class="inline-flex items-center justify-center w-16 h-16 bg-bz-red/10 border border-bz-red/30 rounded-full mb-6">
        <svg class="w-8 h-8 text-bz-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
        </svg>
      </div>

      <!-- Heading -->
      <h2 class="text-display-md font-display font-bold text-bz-white mb-4">
        Get Weekly Insights
      </h2>

      <p class="text-body-lg text-bz-white/70 mb-8">
        Deep analysis about Bali business trends, expat economy, and Indonesian regulations.
        Delivered every week. No spam, just insights.
      </p>

      <!-- Form -->
      <form
        id="newsletter-form"
        class="flex flex-col sm:flex-row gap-4 max-w-lg mx-auto"
        data-endpoint="https://ts-backend-production-568d.up.railway.app/api/newsletter/subscribe"
      >
        <input
          type="email"
          name="email"
          placeholder="your@email.com"
          required
          class="flex-1 px-6 py-4 bg-bz-black border border-bz-gray/30 rounded-lg text-bz-white placeholder:text-bz-gray focus:outline-none focus:border-bz-red transition-colors"
        />
        <button
          type="submit"
          class="cta-button whitespace-nowrap"
        >
          Subscribe
        </button>
      </form>

      <!-- Success/Error messages -->
      <div id="newsletter-message" class="mt-4 text-sm hidden"></div>

      <!-- Privacy note -->
      <p class="text-body-sm text-bz-gray mt-6">
        We respect your privacy. Unsubscribe anytime.
      </p>
    </div>
  </div>
</section>

<script>
  // Newsletter form handling
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const message = document.getElementById('newsletter-message');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const email = formData.get('email');
    const endpoint = form.dataset.endpoint;

    if (!endpoint) return;

    try {
      const response = await fetch(endpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email }),
      });

      if (response.ok) {
        if (message) {
          message.textContent = '✅ Successfully subscribed! Check your email.';
          message.className = 'mt-4 text-sm text-green-500';
          message.classList.remove('hidden');
        }
        form.reset();
      } else {
        throw new Error('Subscription failed');
      }
    } catch (error) {
      if (message) {
        message.textContent = '❌ Something went wrong. Please try again.';
        message.className = 'mt-4 text-sm text-bz-red';
        message.classList.remove('hidden');
      }
    }
  });
</script>
